#include <stdio.h>
#include <stdlib.h>
#include <SDL2/SDL.h>
#include <math.h>


#define PI 3.141592654 

//Screen dimension
const int SCREEN_WIDTH  = 1360;	//window height
const int SCREEN_HEIGHT = 620;	//window width

SDL_Window *Window;  	//The window we'll be rendering
SDL_Renderer *Renderer;	//The renderer SDL will use to draw

struct poligonos {
	int len_vertice;
	int activo_window;
	int color[3];
	int vertice[1206];
}poligono[200];



int cantidad_tecturas = 4;
int TEXTURA[4][3600][3600][3];
int xpt[4],ypt[4];

int activacion_textura = 0;
int tipo_textura = 0;

double zoom =0.5;
int veces_rotar = 0;
int delta_X=-SCREEN_WIDTH;
int delta_Y=-SCREEN_HEIGHT;
int x_firma = 0;
int y_firma = 0;
int firma_flag = 0;
int color_mustang_flag = 0;
int m = 2;



static void Read_Textura(){
	char bufer[10];
	int fila = 0;
	int columna = 0;
	int color_depth = 0;
	int p;

	FILE *archivo;
	for (int i = 0; i<4; i++){
		switch(i){
			case 0: archivo = fopen("Mustang.ppm", "r"); // Modo lectura
			break;
			case 1: archivo = fopen("Textura1.ppm", "r"); // Modo lectura
			break;
			case 2: archivo = fopen("Textura2.ppm", "r"); // Modo lectura
			break;
			case 3: archivo = fopen("Ernesto.ppm", "r"); // Modo lectura
			break;
			//default: archivo = fopen("Mustang.ppm", "r"); // Modo lectura
			//break;
		}
		if(archivo == NULL){
			printf("Error al leer el archivo\n");
		}

		long double count = 0;
		

		while(fgets(bufer, 10, archivo)){
			strtok(bufer, "\n");
		
			int moco = atoi(bufer);
			if(count == 1) xpt[i] = moco;
			else if(count == 2) ypt[i] = moco;

			else if(count >3){
				TEXTURA[i][fila][columna][color_depth] = moco; 
				color_depth++;
				if(color_depth > 2 ){
					color_depth = 0;
					columna++;
					if(columna > xpt[i]-1){
						columna = 0;
						fila++;
						if(fila > ypt[i]-1){
							fila = 0;	
						}
					}		
				}
			}
			//printf("xpt: %i \n",xpt);
			//printf("ypt: %i \n",ypt);
			count ++;
		} 
	}
}

static void set_color(int r, int g, int b){
	SDL_SetRenderDrawColor(Renderer, r, g, b, 255);
}

static void plot_pixel(int x,int y){	
	if ((x>=0) && (y>=00) && (x<=SCREEN_WIDTH) && (y <= SCREEN_HEIGHT)){
		if(activacion_textura == 1){
			set_color(TEXTURA[tipo_textura][y%ypt[tipo_textura]][x%xpt[tipo_textura]][0],TEXTURA[tipo_textura][y%ypt[tipo_textura]][x%xpt[tipo_textura]][1],TEXTURA[tipo_textura][y%ypt[tipo_textura]][x%xpt[tipo_textura]][2]);
		}

		SDL_RenderDrawPoint(Renderer,x,y);
		
	}
}

static void plot_line_Bresenham(int x0, int y0, int x1, int y1){
	
	int delta_E, delta_NE, d, xp, yp;
	
	xp = x0;
	yp = y0;
	plot_pixel(xp,yp);
	
	if (abs(x0-x1)>abs(y0-y1)){//menores de 45
		delta_E  = 2*abs(y1-y0);
		delta_NE = 2*(abs(y1-y0)-abs(x1-x0));
		d = 2 * abs(y1-y0)-abs(x1-x0);	
		if (x0<x1){//derecha
			if (y0<y1){//octante 8
				while(xp<x1){
					if(d <= 0){d = d + delta_E;}
					else{
						yp++;
						d = d + delta_NE;
					}xp ++;
					plot_pixel(xp,yp);
				}
			}else{//octante 1
				while(xp<x1){
					if(d <= 0){d = d + delta_E;}
					else{
						yp--;
						d = d + delta_NE;
					}xp ++;
					plot_pixel(xp,yp);
				}
			}
		}else{//izquierda
			if (y0>y1){//octante 4
				while(xp>x1){
					if(d <= 0){d = d + delta_E;}
					else{
						yp--;
						d = d + delta_NE;
					}xp--;
					plot_pixel(xp,yp);
				}
			}else{//octante 5
				while(xp>x1){
					if(d <= 0){d = d + delta_E;}
					else{
						yp++;
						d = d + delta_NE;
					}xp --;
					plot_pixel(xp,yp);
				}
			}
		}
	}else if (abs(x0-x1)<=abs(y0-y1)){//mayores de 45
		delta_E  = 2*abs(x1-x0);
		delta_NE = 2*(abs(x1-x0)-abs(y1-y0));
		d = 2 * abs(x1-x0)-abs(y1-y0);
		if (y0<y1){//abajo
			if (x0<x1){//octante 7
				while(yp<y1){
					if(d <= 0){d = d + delta_E;}
					else{xp++;
						d = d + delta_NE;
					}yp ++;
					plot_pixel(xp,yp);
				}
			}else{//octante 6
				while(yp<y1){
					if(d <= 0){d = d + delta_E;}
					else{
						xp--;
						d = d + delta_NE;
					}yp++;
					plot_pixel(xp,yp);
				}
			}
		}else if(y0>y1){//arriba
			if (x0>x1){//octante 3
				while(yp>y1){
					if(d <= 0){d = d + delta_E;}
					else{
						xp--;
						d = d + delta_NE;
					}yp--;
					plot_pixel(xp,yp);
				}
			}else{//octante 2
				while(yp>y1){
					if(d <= 0){d = d + delta_E;}
					else{
						xp++;
						d = d + delta_NE;
					}yp--;
					plot_pixel(xp,yp);
				}	
			}
		}
	}
}

static void crear_poligono(int *lista,int lenlista){
	for (int i = 2; i < lenlista; i+=2){
		plot_line_Bresenham(lista[i-2],lista[i-1],lista[i],lista[i+1]);
	}
}

static void ordenar_lista(int *lista, int lenlista){
	int aux;
	for(int i = 0; i< lenlista; i++){
		for(int j = 0; j < lenlista -1; j++){
			if(lista[j]> lista[j+1]){
				aux = lista[j];
				lista[j] = lista[j+1];
				lista[j+1] = aux;
			}
		}
	}
}

int interseccion(int x0, int y0, int x1, int y1, int scanline){
	long double m, b;

	m = ((y1-y0)+0.0)/(x1-x0);
	b = y0 -m*x0 + 0.0;
	return round((scanline - b)/(m));
}

static void draw_poligono (int *lista,int lenlista){

	int x_intersecciones[lenlista];
	int count = 0;
	long double m;
	int min,max;
	for(int scanline = 0; scanline< SCREEN_HEIGHT; scanline++){
		//printf("\nscanline: %i \n",scanline);
		for(int i = 2; i<lenlista; i+=2){ //rrecorremos la lista de vertices			
			
			if( (scanline >= fmin(lista[i-1],lista[i+1]) && scanline <= fmax(lista[i-1],lista[i+1])) ){ //entra para toda línea no horizontal
				
				
				if (scanline ==lista[i+1]){// Esto es para los vertices en específico
					
					if((i == lenlista-2)){
						
						if(((lista[3]>lista[i+1] && lista[i-1]>lista[i+1]) || (lista[3]<lista[i+1] && lista[i-1]<lista[i+1]))){
								x_intersecciones[count] = lista[i];
								count ++;	
						}
					}
				
					else if( ((lista[i+3]>lista[i+1] && lista[i-1]>lista[i+1]) || (lista[i+3]<lista[i+1] && lista[i-1]<lista[i+1])) ){
								x_intersecciones[count] = lista[i];
								count ++;	
					}
				}

				else if(lista[i-2] == lista[i]){ // si es vertical
					x_intersecciones[count] = lista[i];
					count ++;
				}

				else{ 
					x_intersecciones[count] = interseccion(lista[i-2], lista[i-1], lista[i], lista[i+1], scanline);
					count ++;
				}
			}
		}

		//ordenamos lista
		ordenar_lista(x_intersecciones, count);

		//pintamos
		for(int i = 1; i< count; i+=2){
			for(int j = x_intersecciones[i-1]; j<x_intersecciones[i]; j++){
				plot_pixel(j,scanline);
			}
		}

		//vaciamos x_intersecciones
		for(int i= 0; i< count; i++){
			x_intersecciones[count] = 0;
		}
		count = 0;
	}
}

static void Brezier(int *lista){
	double t;
	int xp,yp;
	for (t = 0; t< 1; t += 0.0001){
		xp = pow((1-t),3)*lista[0] + 3*t*pow((1-t),2)*lista[2] + 3*(1-t)*pow(t,2)*lista[4] + pow(t,3)*lista[6];
		yp = pow((1-t),3)*lista[1] + 3*t*pow((1-t),2)*lista[3] + 3*(1-t)*pow(t,2)*lista[5] + pow(t,3)*lista[7];

		plot_pixel(round(xp), round(yp));
	}
}

static void Firma(){
	int p[8];
	int Firma[11][8] = {40,50,100,-10,30,00,70,60,
						70,60,140,130,50,180,30,140,
						30,140,20,60,100,150,120,120,
						120,120,270,-20,200,-20,180,90,
						180,90,160,190,80,150,170,120,
						170,120,180,110,200,130,260,80,
						340,40,300,-30,230,30,260,80,
						260,80,260,90,300,100,310,90,
						310,90,340,30,310,60,300,120,
						300,120,270,200,210,90,300,110,
						300,110,320,110,330,130,360,120};

	for(int i = 0; i<11; i++){
		for (int j = 0; j<8; j++){
			if(j%2 == 0) Firma[i][j] = Firma[i][j]/abs(m) + (x_firma-180/abs(m));
			else Firma[i][j] = Firma[i][j]/abs(m) +(y_firma-80/abs(m));
			p[j] = Firma[i][j];
		}
		Brezier(p);
	}
}

static void acciones(int *lista,int lop,int a){
	for (int i = 0; i < lop; i+=2){
		lista[i+1]=(
			cos((PI/12)*veces_rotar)*(poligono[a].vertice[i+1]-660)+
			sin((PI/12)*veces_rotar)*(poligono[a].vertice[i]-1512)+
			SCREEN_HEIGHT+delta_Y)*zoom+SCREEN_HEIGHT/2;
		lista[i]=(
			cos((PI/12)*veces_rotar)*(poligono[a].vertice[i]-1512)-
			sin((PI/12)*veces_rotar)*(poligono[a].vertice[i+1]-660)+
			SCREEN_WIDTH+delta_X)*zoom+SCREEN_WIDTH/2;
	}crear_poligono(lista,lop);
}

static void Aray_Poligono(int a,int b[],int num,int R,int G,int B){
	for (int i = 0; i < 1206; ++i){
		poligono[a].vertice[i]=b[i];
	}
	poligono[a].len_vertice=num;
	poligono[a].color[0] =R;
	poligono[a].color[1] =G;
	poligono[a].color[2] =B;
}

static void init(){
	int carroceria[]= {1910,524,1575,351,1570,349,1565,347,1559,345,1553,343,1547,341,1543,340,1539,339,1536,338,1531,337,1528,336,1524,335,1520,334,1516,333,1511,332,1507,331,1502,330,1497,329,1491,328,1486,327,1479,326,1473,325,1468,325,1466,324,1460,324,1458,323,1452,323,1450,322,1442,322,1440,321,1430,321,1428,320,1416,320,1414,319,1394,319,1392,318,1340,318,1338,319,1314,319,1312,320,1296,320,1294,321,1280,321,1278,322,1267,322,1265,323,1254,323,1252,324,1243,324,1241,325,1232,325,1230,326,1222,326,1220,327,1212,327,1210,328,1202,328,1200,329,1193,329,1191,330,1184,330,1182,331,1176,331,1174,332,1167,332,1165,333,1159,333,1157,334,1151,334,1149,335,1143,335,1141,336,1136,336,1134,337,1128,337,1126,338,1121,338,1119,339,1114,339,1112,340,1107,340,1105,341,1101,341,1098,342,1093,342,1091,343,1086,343,1084,344,1080,344,1078,345,1073,345,1071,346,1067,346,1065,347,1061,347,1059,348,1055,348,1053,349,1049,349,1047,350,1043,350,1041,351,1037,351,1035,352,1032,352,650,478,643,480,636,482,626,484,621,485,616,486,610,487,604,488,598,489,586,491,580,492,572,493,564,494,557,495,548,496,541,497,531,498,521,499,509,500,507,501,494,501,492,502,473,502,471,503,413,503,409,504,408,505,406,508,404,512,401,524,399,527,402,536,405,539,405,543,404,548,347,629,340,636,334,641,327,648,320,655,320,661,321,662,321,669,322,671,322,676,323,678,323,682,324,684,324,688,325,690,325,693,326,694,326,697,327,698,328,701,329,704,330,707,332,709,332,712,333,713,333,721,332,724,329,730,326,733,324,739,321,745,318,752,316,758,316,778,322,779,327,781,330,783,336,787,340,792,344,798,354,810,359,816,367,824,373,830,379,836,387,842,394,847,400,851,407,855,416,858,426,860,434,861,436,862,442,862,444,863,452,863,454,864,461,865,472,865,474,866,482,866,484,867,491,868,498,868,500,869,505,869,507,870,511,870,514,871,518,871,520,872,523,873,528,874,532,875,536,876,540,877,543,878,547,879,550,880,553,881,556,882,559,883,563,885,566,886,567,887,571,889,575,891,577,892,618,892,1042,892,1042,908,1041,910,1227,910,1229,911,1274,911,1276,912,1323,912,1325,913,1370,913,1373,914,1419,914,1421,915,1467,915,1469,916,1515,916,1517,917,1563,917,1565,918,1611,918,1613,919,1659,919,1661,920,1707,920,1709,921,1755,921,1757,922,1803,922,1805,923,1851,923,1853,924,1899,924,1901,925,1946,925,1948,926,1954,926,2038,880,2462,892,2486,895,2492,899,2497,902,2504,907,2510,911,2516,916,2524,921,2530,923,2605,923,2607,922,2611,922,2614,921,2621,917,2627,913,2633,909,2640,904,2645,901,2646,898,2646,894,2646,823,2652,819,2657,815,2657,810,2658,809,2658,803,2659,801,2659,793,2660,791,2660,778,2659,774,2658,770,2657,767,2656,764,2655,762,2654,759,2653,757,2652,754,2651,752,2650,749,2649,746,2648,743,2647,740,2646,737,2645,733,2643,728,2643,711,2644,709,2644,703,2645,701,2645,696,2646,694,2646,690,2647,689,2647,685,2648,683,2648,680,2649,678,2649,675,2650,673,2650,670,2651,668,2651,665,2652,663,2652,660,2653,659,2650,656,2645,652,2639,648,2633,644,2628,640,2620,635,2614,631,2607,627,2599,622,2588,617,2577,611,2569,607,2554,600,2545,596,2535,592,2523,587,2513,583,2506,580,2493,575,2483,571,2474,568,2462,564,2453,561,2447,559,2438,556,2431,554,2424,552,2417,550,2409,548,2405,547,2401,546,2396,545,2391,544,2386,543,2381,542,2375,541,2369,541,2366,540,2359,540,2357,539,2349,539,2347,538,2340,538,2338,537,2331,537,2329,536,2322,536,2320,535,2313,535,2311,534,2304,534,2302,533,2295,533,2294,532,2286,532,2284,531,2278,531,2275,530,2267,530,2265,529,2258,529,2256,528,2248,528,2246,527,2238,527,2236,526,2227,526,2225,525,2216,525,2205,524,2193,523,2181,522,2168,521,2154,520,2139,519,2123,518,2120,517,2104,517,2102,516,2082,516,2079,515,2052,515,2051,513,1948,514,1926,521,1910,524};
	int ventana_negro[122]= {891,439,891,435,908,427,923,422,940,417,961,412,980,407,992,404,1008,400,1021,397,1038,393,1056,389,1076,385,1091,382,1109,379,1127,375,1142,373,1161,371,1190,368,1224,365,1253,363,1271,362,1296,361,1366,361,1402,363,1432,366,1461,370,1480,374,1500,379,1520,385,1547,395,1571,405,1594,415,1619,427,1636,435,1666,450,1688,462,1743,491,1765,504,1777,511,1789,518,1792,520,1652,516,1573,514,1473,511,1374,508,1275,505,1180,502,1127,499,1079,496,1038,493,1003,490,974,487,952,484,937,481,931,479,922,473,911,464,902,455,893,443,891,439};
	int ventana_celeste[84]= {914,445,936,437,954,432,972,427,987,423,1007,418,1037,411,1069,404,1100,398,1129,393,1145,391,1182,387,1224,383,1254,381,1273,380,1298,379,1368,379,1412,382,1439,385,1468,390,1497,397,1518,404,1538,411,1562,421,1579,428,1596,436,1616,445,1638,456,1662,469,1648,501,1563,499,1467,496,1363,493,1272,490,1178,487,1109,483,1050,479,1003,475,974,472,939,466,930,460,915,445};
	int ventana_gris[52]= {1147,382,1181,380,1177,388,1175,394,1175,407,1177,410,1182,425,1186,434,1192,448,1197,460,1203,474,1209,486,1215,499,1193,499,1192,498,1189,498,1184,486,1180,475,1176,464,1171,450,1166,436,1162,425,1156,409,1151,395,1147,385,1147,382};
	int parte_negra_llanta_trasera[]= {619,892,619,830,620,820,621,813,623,801,625,792,627,785,630,775,633,766,636,759,639,752,643,744,646,738,651,730,656,722,664,711,670,704,682,692,690,685,708,671,725,661,736,656,741,654,763,647,777,643,795,640,804,639,845,639,867,642,880,645,890,648,899,651,909,655,916,658,928,664,942,673,955,682,968,693,977,702,987,713,1001,731,1009,744,1019,763,1026,780,1030,791,1033,802,1036,814,1039,831,1041,850,1040,911,616,928,619,892};
	int parte_negra_llanta_delantera[102]= {2040,880,2040,860,2041,835,2045,816,2049,799,2054,783,2059,770,2064,759,2069,749,2075,739,2082,728,2095,711,2111,695,2134,677,2155,665,2176,656,2204,648,2224,645,2236,644,2265,644,2284,646,2300,649,2314,653,2323,656,2333,660,2346,666,2355,671,2366,678,2374,684,2384,692,2395,702,2404,712,2413,723,2420,733,2427,744,2436,760,2442,773,2448,789,2453,806,2457,823,2460,843,2461,857,2461,935,2040,927,2040,936,2011,934,1986,932,1955,930,1955,925,2002,882,2040,880};
	Aray_Poligono(0,carroceria,sizeof(carroceria)/sizeof(int),225,225,225);
	Aray_Poligono(1,ventana_negro,122,0,0,0);
	Aray_Poligono(2,ventana_celeste,84,70,95,100);
	Aray_Poligono(3,ventana_gris,52,75,75,75);
	Aray_Poligono(4,parte_negra_llanta_trasera,sizeof(parte_negra_llanta_trasera)/sizeof(int),0,0,0);
	Aray_Poligono(5,parte_negra_llanta_delantera,102,0,0,0);
	int llanta_externa[74] = {655,865,656,834,664,805,677,777,694,751,716,729,742,712,770,699,799,691,830,688,861,691,891,699,919,712,944,730,966,751,983,777,996,805,1004,834,1008,865,1004,896,996,926,983,954,966,979,944,1001,919,1018,891,1031,861,1039,830,1042,799,1039,770,1031,742,1018,716,1001,694,979,677,953,664,926,656,896,655,865};
	int llanta_interna[74] = {968,865,966,889,960,912,950,934,936,953,919,970,900,984,878,994,855,1000,831,1002,807,1000,784,994,763,984,743,970,726,953,712,934,702,912,696,889,694,865,696,841,702,818,712,797,726,777,743,760,763,746,784,736,807,730,831,728,855,730,878,736,900,746,919,760,936,777,950,797,960,818,966,841,968,865};
	int llanta_freno[74]={918,865,917,880,913,895,906,909,898,921,887,932,875,940,861,947,846,951,831,952,816,951,801,947,788,940,775,932,764,921,756,909,749,895,745,880,744,865,745,850,749,835,756,822,764,809,775,798,788,790,801,783,816,779,831,778,846,779,861,783,875,790,887,798,898,809,906,822,913,835,917,850,918,865};
	int llanta_aro[74] = {893,865,892,876,889,886,885,896,878,905,871,912,862,919,852,923,842,926,831,927,820,926,810,923,800,919,791,912,784,905,777,896,773,886,770,876,769,865,770,854,773,844,777,834,784,825,791,818,800,811,810,807,820,804,831,803,842,804,852,807,862,811,871,818,878,825,885,834,889,845,892,854,893,865};
	int llanta_eje[38] = {844,865,843,869,841,873,838,876,833,878,829,878,825,876,821,873,819,869,818,865,819,861,821,857,825,854,829,852,833,852,838,854,841,857,843,861,844,865};
	Aray_Poligono(6,llanta_externa,74,50,50,50);
	Aray_Poligono(7,llanta_interna,74,25,25,25);
	Aray_Poligono(8,llanta_freno,74,150,150,150);
	Aray_Poligono(9,llanta_aro,74,25,25,25);
	Aray_Poligono(10,llanta_eje,38,180,180,180);
	int frenos[66]	=	{769,787,777,794,785,801,781,806,777,812,775,815,772,822,769,829,767,835,766,838,763,851,761,864,760,875,760,883,761,889,762,895,762,900,755,907,740,907,740,901,738,893,737,886,736,878,735,859,736,848,738,837,741,827,745,817,750,808,755,801,760,795,766,790,769,787};
	int aro1[46] 	=	{761,756,772,747,785,762,805,788,815,802,818,806,809,813,802,818,797,822,793,824,792,823,791,819,790,814,789,810,787,807,784,800,781,794,778,786,776,782,773,777,769,770,764,762,761,756};
	int aro2[60] 	= 	{849,806,851,805,854,802,856,801,869,788,880,776,885,770,890,763,894,758,899,751,902,752,907,755,912,759,911,761,908,766,905,772,902,778,899,783,897,787,888,802,885,807,881,814,878,818,876,821,874,823,865,817,859,813,854,810,851,808,849,806};
	int aro3[36] 	= 	{884,846,892,848,904,851,915,852,930,852,959,852,959,867,951,868,940,870,932,871,918,873,910,874,900,875,891,876,886,876,885,864,884,851,884,846};
	int aro4[56] 	= 	{844,923,850,919,856,915,862,911,867,908,869,907,871,908,874,913,877,918,882,926,885,931,889,938,891,942,894,947,896,951,899,956,902,961,907,971,900,976,894,979,888,972,883,965,878,957,872,950,865,942,855,932,849,927,844,923};
	int aro5[50] 	= 	{788,906,795,911,804,917,812,923,812,925,802,939,797,946,792,952,788,957,780,967,773,976,767,982,760,977,755,973,761,964,766,956,771,947,775,940,778,934,780,929,782,924,785,916,786,913,787,910,788,906};
	int aro6[36] 	= 	{776,838,776,851,775,862,775,869,772,868,765,865,751,861,743,859,737,858,728,856,719,855,711,854,702,854,702,847,702,839,704,838,737,838,776,838};
	int tuerca1[34] =	{833,830,838,830,840,831,843,834,844,836,844,842,843,844,840,847,838,848,833,848,831,847,828,844,827,842,827,836,828,834,831,831,833,830};
	int tuerca2[34] =	{856,854,861,854,863,855,866,858,867,860,867,866,866,868,863,871,861,872,856,872,854,871,851,868,850,866,850,860,851,858,854,855,856,854};
	int tuerca3[34] =	{802,843,807,843,809,844,812,847,813,849,813,855,812,857,809,860,807,861,802,861,800,860,797,857,796,855,796,849,797,847,800,844,802,843};
	int tuerca4[34] =	{839,884,844,884,846,885,849,888,850,890,850,896,849,898,846,901,844,902,839,902,837,901,834,898,833,896,833,890,834,888,837,885,839,884};
	int tuerca5[34] =	{805,877,810,877,812,878,815,881,816,883,816,889,815,891,812,894,810,895,805,895,803,894,800,891,799,889,799,883,800,881,803,878,805,877};
	Aray_Poligono(11,frenos,66,200,0,0);
	Aray_Poligono(12,aro1,46,0,0,0);
	Aray_Poligono(13,aro2,60,0,0,0);
	Aray_Poligono(14,aro3,36,0,0,0);
	Aray_Poligono(15,aro4,56,0,0,0);
	Aray_Poligono(16,aro5,50,0,0,0);
	Aray_Poligono(17,aro6,36,0,0,0);
	Aray_Poligono(18,tuerca1,34,100,100,100);
	Aray_Poligono(19,tuerca2,34,100,100,100);
	Aray_Poligono(20,tuerca3,34,100,100,100);
	Aray_Poligono(21,tuerca4,34,100,100,100);
	Aray_Poligono(22,tuerca5,34,100,100,100);
	//copia de llanta
	for (int i = 6; i <= 22; ++i){poligono[i+17]=poligono[i];
		for (int j = 0; j < poligono[i+17].len_vertice; ++j){
			if (j%2==0){poligono[i+17].vertice[j]=poligono[i+17].vertice[j]+1420;
			}
		}
	}
	int foco_externa[230] = {2419,637,2419,635,2423,630,2427,630,2429,631,2435,631,2437,632,2444,632,2447,633,2453,633,2455,634,2462,634,2464,635,2471,635,2473,636,2480,636,2482,637,2489,637,2491,638,2498,638,2500,639,2507,639,2509,640,2516,640,2519,641,2522,641,2528,642,2535,642,2537,643,2544,643,2546,644,2553,644,2555,645,2562,645,2564,646,2571,646,2573,647,2580,647,2582,648,2589,648,2592,649,2598,649,2600,650,2607,650,2610,651,2616,651,2617,652,2614,653,2612,654,2610,655,2608,656,2606,657,2604,658,2603,659,2603,662,2602,662,2602,665,2601,668,2600,670,2599,671,2599,673,2598,675,2597,678,2596,680,2595,682,2594,684,2593,686,2592,688,2591,690,2590,692,2588,695,2584,699,2583,700,2557,700,2556,699,2548,699,2546,698,2540,698,2538,697,2532,697,2530,696,2526,696,2524,695,2519,695,2517,694,2514,694,2512,693,2507,692,2502,691,2498,690,2494,689,2490,688,2487,687,2484,686,2481,685,2479,684,2477,683,2473,681,2470,679,2466,677,2464,675,2461,674,2459,672,2456,670,2453,668,2449,665,2447,663,2444,661,2442,660,2432,651,2429,648,2428,648,2422,642,2420,638,2419,637};
	int foco_gris[92] =    {2424,637,2424,635,2434,635,2436,636,2442,636,2444,637,2451,637,2454,638,2460,638,2463,639,2469,639,2472,640,2480,640,2482,641,2488,641,2490,642,2497,642,2499,643,2504,643,2505,644,2505,688,2501,687,2497,686,2493,685,2489,684,2486,683,2483,682,2481,681,2479,680,2475,678,2472,676,2469,674,2466,672,2463,670,2460,668,2457,666,2453,663,2449,660,2445,657,2441,653,2438,651,2435,648,2432,646,2429,643,2425,639,2424,637};
	int foco_destello[48]= {2469,645,2470,644,2471,642,2472,641,2474,639,2478,639,2479,640,2480,641,2481,642,2482,643,2483,644,2484,645,2484,646,2483,647,2482,648,2482,649,2481,650,2480,651,2479,652,2473,652,2472,651,2470,649,2470,646,2469,645};
	int foco_naranja[200]= {2436,643,2436,640,2438,639,2441,639,2443,640,2448,640,2453,641,2468,641,2470,642,2469,644,2469,646,2469,649,2471,651,2472,652,2474,653,2479,653,2481,651,2483,649,2484,648,2485,649,2486,651,2487,653,2488,655,2489,656,2490,658,2491,660,2492,661,2493,663,2494,665,2495,667,2497,670,2497,673,2473,674,2471,672,2468,670,2466,668,2464,666,2462,665,2460,663,2457,661,2455,659,2452,657,2450,655,2447,652,2444,650,2441,647,2439,646,2437,644,2436,643};
	int foco_linea_1[70]= {2532,644,2536,645,2539,645,2539,648,2538,651,2537,654,2536,657,2535,661,2534,664,2533,667,2532,670,2531,673,2530,677,2529,680,2528,683,2527,686,2526,690,2525,693,2519,693,2517,692,2518,689,2519,686,2520,683,2521,679,2522,676,2523,672,2524,669,2525,666,2526,663,2527,660,2528,657,2529,653,2530,650,2531,647,2532,644};
	int foco_linea_2[66]= {2553,646,2556,647,2560,647,2560,649,2559,652,2558,656,2557,659,2556,662,2555,665,2554,669,2553,673,2552,676,2551,680,2549,683,2548,688,2547,692,2546,696,2538,696,2537,693,2538,690,2540,686,2541,683,2542,679,2543,676,2544,673,2544,670,2546,666,2548,662,2549,658,2550,655,2551,652,2552,649,2553,646};
	int foco_linea_3[68]= {2574,649,2576,650,2579,650,2579,653,2578,655,2578,657,2577,660,2576,663,2575,667,2574,670,2573,674,2572,677,2571,681,2570,684,2569,687,2568,690,2567,694,2566,698,2558,698,2559,694,2560,690,2561,687,2562,684,2563,681,2564,678,2565,675,2566,672,2567,669,2568,666,2569,662,2570,659,2571,655,2573,652,2574,649};
	Aray_Poligono(40,foco_externa,230,25,25,25);
	Aray_Poligono(41,foco_gris,92,190,190,190);
	Aray_Poligono(42,foco_destello,48,250,250,250);
	Aray_Poligono(43,foco_naranja,98,200,120,25);
	Aray_Poligono(44,foco_linea_1,70,250,250,250);
	Aray_Poligono(45,foco_linea_2,66,250,250,250);
	Aray_Poligono(46,foco_linea_3,68,250,250,250);
	int bumper []= {2458,936,2458,890,2481,895,2487,896,2500,904,2510,911,2518,918,2529,924,2613,920,2618,916,2633,909,2645,902,2646,898,2646,894,2632,884,2617,874,2609,873,2593,871,2575,868,2564,865,2558,858,2548,840,2536,813,2531,799,2531,793,2533,783,2536,777,2543,770,2547,768,2574,768,2609,771,2608,774,2604,777,2604,787,2607,796,2614,796,2603,806,2596,806,2588,805,2592,812,2593,816,2595,818,2601,823,2608,826,2615,828,2621,829,2631,831,2638,827,2643,825,2652,827,2657,833,2662,844,2669,859,2675,873,2679,885,2681,894,2681,909,2679,913,2672,921,2685,930,2692,937,2693,939,2689,944,2658,944,2618,943,2571,942,2500,940,2458,939,2458,936};
	int bumper_gris [] = {2552,792,2555,784,2558,779,2562,775,2573,774,2582,774,2591,775,2597,777,2598,780,2599,794,2552,792};
	int luz_roja_pequena [] = {451,785,439,773,475,774,515,776,542,777,540,782,536,787,532,790,510,790,477,788,451,785};
	int gasolina [] = {544,571,546,556,549,548,553,541,560,534,569,527,579,523,584,522,601,522,609,524,618,529,627,536,635,546,639,555,641,565,641,576,638,587,635,594,631,600,625,607,617,612,606,617,598,619,585,619,576,616,567,612,559,606,554,600,549,593,546,587,545,580,544,579,544,571};
	int puerta [] = {1181,503,1173,519,1167,532,1162,545,1159,554,1154,569,1152,578,1152,586,1151,595,1154,605,1158,621,1162,637,1167,653,1172,671,1176,683,1183,707,1191,729,1198,748,1207,770,1214,785,1224,803,1235,821,1249,842,1261,856,1268,862,1281,870,1295,874,1308,877,1324,879,1344,880,1843,888,1856,875,1860,860,1864,845,1867,833,1868,825,1869,801,1872,775,1878,734,1883,703,1887,672,1889,650,1889,626,1888,606,1887,597,1884,588,1880,577,1875,568,1872,561,1866,552,1858,542,1850,538,1836,534,1825,530,1807,524,1771,520,1181,503};
	int corta_aire [] = {1889,821,1890,817,1906,792,1919,772,1929,757,1941,737,1956,712,1974,681,1984,662,1998,634,1984,616,1978,613,1969,604,1970,602,1975,602,1994,610,2007,619,2013,625,2017,631,2017,635,2014,645,2007,662,1997,683,1986,705,1962,747,1951,764,1939,782,1925,799,1911,814,1898,824,1893,824,1889,821};
	int detalle_horizontal [] = {1899,640,1899,635,1901,632,1977,632,1979,635,1979,640,1977,642,1901,642,1899,640};
	int luz_trasera []= {346,621,346,619,357,605,368,590,381,573,396,553,401,547,405,547,411,555,415,563,417,570,417,579,414,587,407,596,405,599,396,608,388,615,374,625,371,626,362,626,352,624,346,621};
	int parabrisas_trasero [] = {1032,352,991,360,965,367,945,373,927,378,903,385,884,391,863,398,839,406,818,413,798,420,773,429,749,438,723,448,701,456,685,463,651,478,681,469,710,460,741,450,779,438,804,430,843,418,873,409,901,401,931,393,956,387,991,379,1021,373,1056,366,1053,361,1044,356,1032,352};
	int parabrisas_delantero[] = {1576,352,1566,359,1568,365,1587,372,1603,379,1621,388,1645,400,1667,412,1686,423,1714,439,1747,459,1776,477,1803,494,1829,511,1847,524,1910,524,1907,517,1886,505,1864,493,1842,481,1821,470,1789,453,1761,438,1724,419,1686,400,1645,380,1615,366,1581,353,1576,352};
	Aray_Poligono(47,bumper,sizeof(bumper)/sizeof(int),30,30,30);
	Aray_Poligono(48,bumper_gris,sizeof(bumper_gris)/sizeof(int),190,190,190);
	Aray_Poligono(49,luz_roja_pequena,sizeof(luz_roja_pequena)/sizeof(int),110,0,0);
	Aray_Poligono(50,gasolina,sizeof(gasolina)/sizeof(int),160,160,160);
	Aray_Poligono(51,puerta,sizeof(puerta)/sizeof(int),170,170,170);
	Aray_Poligono(52,corta_aire,sizeof(corta_aire)/sizeof(int),0,0,0);
	Aray_Poligono(53,detalle_horizontal,sizeof(detalle_horizontal)/sizeof(int),0,0,0);
	Aray_Poligono(54,luz_trasera,sizeof(luz_trasera)/sizeof(int),150,0,0);
	Aray_Poligono(55,parabrisas_trasero,sizeof(parabrisas_trasero)/sizeof(int),100,125,150);
	Aray_Poligono(56,parabrisas_delantero,sizeof(parabrisas_delantero)/sizeof(int),100,125,150);
	int ventana_interior_grande[]= {1238,489,1238,412,1293,407,1324,405,1366,403,1429,403,1458,407,1488,415,1526,427,1556,438,1590,452,1617,464,1653,481,1649,501,1603,500,1531,498,1467,496,1400,494,1334,492,1283,491,1238,489};
	int ventana_interior_pequena[]= {992,461,1020,454,1045,448,1073,441,1079,439,1083,439,1088,446,1091,455,1095,470,1090,475,1052,473,1023,471,997,468,992,461};
	int asiento_parte_negra []= {1255,489,1255,480,1261,467,1263,448,1266,429,1272,417,1280,411,1290,411,1298,421,1298,484,1301,491,1255,489};
	int asiento_parte_gris [] = {1259,489,1259,480,1264,469,1266,454,1269,434,1273,422,1281,415,1289,415,1294,421,1294,484,1296,490,1259,489};
	int volante_parte_negra [] = {1580,499,1591,473,1601,456,1610,456,1615,461,1615,469,1610,481,1602,500,1580,499};
	int volante_parte_gris [] = {1585,499,1593,478,1603,460,1607,460,1611,464,1611,468,1604,484,1598,499,1585,499};
	int retrovisor[]= {1650,516,1649,498,1652,478,1658,469,1665,464,1665,464,1690,464,1704,470,1724,486,1736,496,1757,508,1772,522,1777,527,1777,532,1772,535,1707,535,1703,526,1676,524,1666,522,1653,517,1650,516};
	Aray_Poligono(57,ventana_interior_grande,sizeof(ventana_interior_grande)/sizeof(int),125,175,200);
	Aray_Poligono(58,ventana_interior_pequena,sizeof(ventana_interior_pequena)/sizeof(int),125,175,200);
	Aray_Poligono(59,asiento_parte_negra,sizeof(asiento_parte_negra)/sizeof(int),50,75,80);
	Aray_Poligono(60,asiento_parte_gris,sizeof(asiento_parte_gris)/sizeof(int),70,95,100);
	Aray_Poligono(61,volante_parte_negra,sizeof(volante_parte_negra)/sizeof(int),50,75,80);
	Aray_Poligono(62,volante_parte_gris,sizeof(volante_parte_gris)/sizeof(int),70,95,100);
	Aray_Poligono(63,retrovisor,sizeof(retrovisor)/sizeof(int),0,0,0);
	int aleron []= {420,503,422,497,425,492,425,485,408,465,385,442,369,425,360,415,360,412,365,409,380,409,407,416,431,422,453,427,488,435,514,441,541,447,567,453,593,459,607,462,607,467,599,469,584,472,569,476,557,480,546,486,550,497,520,500,494,501,471,503,420,503};
	int detalle_trasero [] = {401,603,407,608,428,629,443,643,463,661,483,677,494,683,502,685,526,688,596,691,683,691,686,688,679,688,568,688,518,684,498,681,488,677,467,660,439,635,418,614,403,600,401,603};
	int puerta_interno  [] = {1187,504,1179,520,1170,542,1163,561,1157,582,1158,597,1163,612,1167,632,1173,655,1180,679,1188,704,1195,725,1201,741,1210,764,1220,786,1238,816,1255,840,1272,858,1287,865,1324,873,1387,876,1446,878,1520,879,1591,880,1640,881,1700,882,1842,883,1850,874,1858,846,1863,828,1864,800,1866,786,1869,761,1873,738,1880,700,1883,674,1884,656,1884,629,1883,605,1881,595,1873,576,1865,559,1858,549,1850,541,1828,532,1803,525,1791,522,1645,517,1578,515,1476,512,1378,509,1281,506,1187,504};
	int gasolina_interno[] = {550,570,553,556,560,544,572,534,587,529,597,529,615,535,626,546,633,558,634,568,634,579,628,592,615,605,607,609,601,611,583,611,566,602,557,592,552,580,551,575,550,570};
	int manilla_externo [] = {1191,590,1191,584,1203,575,1219,571,1242,568,1244,567,1278,567,1295,569,1316,574,1325,578,1331,584,1331,588,1321,597,1299,603,1274,606,1248,606,1222,603,1209,600,1197,595,1191,590};
	int manilla_interno [] = {1195,588,1195,585,1205,579,1222,574,1234,572,1244,571,1278,571,1295,573,1309,576,1322,581,1327,585,1327,587,1316,594,1299,599,1284,601,1273,602,1249,602,1229,600,1214,597,1204,594,1197,590,1195,588};
	int sombra_carro    [] = {328,1061,328,1053,340,1047,347,1046,2702,1046,2715,1049,2718,1052,2718,1060,2709,1065,2701,1067,338,1067,331,1060,328,1061};
	int destello_luz_trasera1 [] = {351,618,353,618,361,607,369,595,378,582,384,574,393,560,401,549,402,547,400,547,389,562,381,573,372,586,364,597,350,617,351,618};
	int destello_luz_trasera2 [] = {361,620,363,620,372,608,383,593,391,582,400,570,411,555,408,550,399,562,390,575,381,588,371,603,360,619,361,620};
	int destello_retrovisor []= {1671,469,1671,467,1677,465,1696,465,1704,468,1706,470,1699,476,1684,476,1676,473,1671,469};
	Aray_Poligono(65,aleron,sizeof(aleron)/sizeof(int),0,0,0);
	Aray_Poligono(66,detalle_trasero,sizeof(detalle_trasero)/sizeof(int),0,0,0);
	Aray_Poligono(67,puerta_interno,sizeof(puerta_interno)/sizeof(int),225,225,225);
	Aray_Poligono(68,gasolina_interno,sizeof(gasolina_interno)/sizeof(int),225,225,225);
	Aray_Poligono(69,manilla_externo,sizeof(manilla_externo)/sizeof(int),0,0,0);
	Aray_Poligono(70,manilla_interno,sizeof(manilla_interno)/sizeof(int),225,225,225);
	Aray_Poligono(71,sombra_carro,sizeof(sombra_carro)/sizeof(int),85,120,150);
	Aray_Poligono(72,destello_luz_trasera1,sizeof(destello_luz_trasera1)/sizeof(int),180,125,125);
	Aray_Poligono(73,destello_luz_trasera2,sizeof(destello_luz_trasera2)/sizeof(int),180,125,125);
	Aray_Poligono(74,destello_retrovisor,sizeof(destello_retrovisor)/sizeof(int),80,80,80);
	int formas1[]={616,928,582,926,533,923,486,920,470,918,460,915,450,911,440,906,433,902,415,901,409,900,401,898,391,894,383,889,376,883,373,878,340,875,338,840,301,791,302,787,303,783,309,780,316,778,322,780,327,782,333,784,338,788,342,794,345,799,351,806,363,820,379,836,393,847,405,854,421,860,442,862,462,864,491,867,512,870,530,874,546,878,557,882,563,885,571,889,576,889,619,892,616,928};
	Aray_Poligono(75,formas1,sizeof(formas1)/sizeof(int),0,0,0);


	for (int i = 100; i < 200; ++i){
		poligono[i]=poligono[i-100];
	}
}

int main(int argc, char *argv[]) {
	//SDL Window setup
	SDL_CreateWindowAndRenderer(SCREEN_WIDTH, SCREEN_HEIGHT, 0, &Window, &Renderer); //SDL_WINDOW_FULLSCREEN_DESKTOP

	if (Window == NULL) {
		printf("No se puede inicializar el modo gráfico: %s \n",SDL_GetError());
		exit(1);
	}
	
	//Clean Windows
	SDL_SetRenderDrawColor(Renderer, 0, 0, 0, 0);
	SDL_RenderClear(Renderer);

	//Adjust Complete Window
	//SDL_SetHint(SDL_HINT_RENDER_SCALE_QUALITY, "linear");  // make the scaled rendering look smoother.
	//SDL_RenderSetLogicalSize(Renderer, SCREEN_WIDTH, SCREEN_HEIGHT); //Resolución a trabajar, el SDL lo escala a pantalla completa
	
	
	//Iniciar textura mustang
	Read_Textura();
	//Iniciar imagen mustang
	init();

	set_color(255,0,0);
	SDL_RenderPresent(Renderer);

	int exit = 0;
	int veces = 0;
	int plus_move = 1;
	
	//Gameloop
	while(exit != 10) {
		//check for new events every frame
		
		SDL_Event event;

		while (SDL_PollEvent(&event)) {
      
            switch (event.type) {
 
	            case SDL_QUIT:
	                	exit = 10;
	            break;

	 			case SDL_MOUSEBUTTONUP:
	 				x_firma = event.motion.x;
	 				y_firma = event.motion.y;
	 				if (firma_flag == 1){firma_flag = 0;}
					else{firma_flag = 1;}
	 			break;

	 			case SDL_MOUSEWHEEL:
	 				if (firma_flag == 1){
		 				if(event.wheel.y < 0){
		 					if(m >1) m --; 
		 				}
		 				else if(m<4) m++;
	 				}
	 				
	 			break;

	            case SDL_KEYDOWN:{
	                // keyboard API for key pressed
	                switch (event.key.keysym.scancode) {
		                case SDL_SCANCODE_ESCAPE:
		                	exit = 10;
		                break;

		                case SDL_SCANCODE_M:
		                	plus_move += 10;
		                break;	

		                case SDL_SCANCODE_W:
		                	delta_Y=delta_Y-ceil(1/zoom)*plus_move;
		                break;

		                case SDL_SCANCODE_S:
		                    delta_Y=delta_Y+ceil(1/zoom)*plus_move;
		                break;
		                
		                case SDL_SCANCODE_A:
		                    delta_X=delta_X-ceil(1/zoom)*plus_move;
		                break;
		                
		                case SDL_SCANCODE_D:
		                    delta_X=delta_X+ceil(1/zoom)*plus_move;
		                break;
		                
		                case SDL_SCANCODE_Z:
		                 	if (veces>-4){veces--;zoom=zoom/2;}
		                break;

		                case SDL_SCANCODE_X:
		                    if (veces<4){veces++;zoom=zoom*2;}
		                break;
		                
		                case SDL_SCANCODE_F:
		                    init();
							veces = 0;
							zoom =0.5;
							delta_X=-SCREEN_WIDTH;
							delta_Y=-SCREEN_HEIGHT;
							veces_rotar = 0;
							exit = 0;
							plus_move = 1;
							firma_flag = 0;
							color_mustang_flag = 0;
							tipo_textura = 0;
							activacion_textura=0;
		                break;
		                
		                case SDL_SCANCODE_P:
							if (exit ==0){exit = 1;}
							else{exit = 0;}
		                break;

		                case SDL_SCANCODE_T:
							if (activacion_textura == 1){activacion_textura = 0; tipo_textura ++; if(tipo_textura >cantidad_tecturas-1) tipo_textura = 0;}
							else{activacion_textura = 1; }
		                break;

		                case SDL_SCANCODE_E:
		                    veces_rotar++;
		                break;

		                case SDL_SCANCODE_Q:
		                    veces_rotar--;
		                break;

		                case SDL_SCANCODE_Y:
							if (color_mustang_flag == 1){
								color_mustang_flag = 0;
								poligono[0].color[0] = 225;
								poligono[0].color[1] = 225;
								poligono[0].color[2] = 225;
								poligono[67].color[0] = 225;
								poligono[67].color[1] = 225;
								poligono[67].color[2] = 225;
								poligono[68].color[0] = 225;
								poligono[68].color[1] = 225;
								poligono[68].color[2] = 225;
								poligono[70].color[0] = 225;
								poligono[70].color[1] = 225;
								poligono[70].color[2] = 225;
							}
							else{
								color_mustang_flag = 1;
								poligono[0].color[0] = 120;
								poligono[0].color[1] = 0;
								poligono[0].color[2] = 0;
								poligono[67].color[0] = 120;
								poligono[67].color[1] = 0;
								poligono[67].color[2] = 0;
								poligono[68].color[0] = 120;
								poligono[68].color[1] = 0;
								poligono[68].color[2] = 0;
								poligono[70].color[0] = 120;
								poligono[70].color[1] = 0;
								poligono[70].color[2] = 0;
							}
		                break;

		                default:
		                break;
	                }
	            }
	            break;

	            default:
	            
	            break;
            }
        }

		
		if (exit == 1){
			for (int i = 0; i < 100; ++i){			
				set_color(poligono[i].color[0],poligono[i].color[1],poligono[i].color[2]);
				acciones(poligono[i+100].vertice,poligono[i].len_vertice,i);
				draw_poligono(poligono[i+100].vertice,poligono[i].len_vertice);
			}	
		}else{
			for (int i = 0; i < 100; ++i){			
				set_color(poligono[i].color[0],poligono[i].color[1],poligono[i].color[2]);
				acciones(poligono[i+100].vertice,poligono[i].len_vertice,i);

			}
		}
		
		if(firma_flag == 1){
			if (activacion_textura == 1){

				activacion_textura = 0;
				set_color(255,0,0);
				Firma();
				activacion_textura = 1;
			}else{
				set_color(255,0,0);
				Firma();
			}
        }


		//Rendering
    	SDL_RenderPresent(Renderer);
    	SDL_SetRenderDrawColor(Renderer,100,150,200,0);
    	SDL_RenderClear(Renderer);

	
	}
	SDL_DestroyRenderer(Renderer);
    SDL_DestroyWindow(Window);
    SDL_Quit();
	return 0;
}